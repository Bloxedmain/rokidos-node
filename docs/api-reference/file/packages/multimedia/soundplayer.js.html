<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">packages/multimedia/soundplayer.js | rokidos</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">packages/multimedia/soundplayer.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

/**
 * @module soundplayer
 */

var child_process = require(&apos;child_process&apos;);
var url = require(&apos;url&apos;);
var path = require(&apos;path&apos;);
var PA_HOME_DIR = process.env.PULSEAUDIO_HOME || &apos;/data/pulseaudio&apos;;

function defaultCallback(err) {
  if (err) throw err;
}

/**
 * @method set
 * @param {String} name - the config name
 * @param {any} val
 */
function set(name, val) {
  if (name === &apos;pulseaudio.homedir&apos;) {
    PA_HOME_DIR = val;
  } else {
    throw new Error(`unknown property ${name}`);
  }
}

/**
 * @class SoundPlayer
 * @constructor
 * @param {String} media - the media url to play
 */
function SoundPlayer(media) {
  this._media = media;
  this._subprocess = null;
  this._cmd = &apos;&apos;;
}

/**
 * @method play
 * @param {Function} callback &lt;optional&gt; fired when play is done
 * @return {SoundPlayer}
 */
SoundPlayer.prototype.play = function play(callback) {
  var meta = url.parse(this._media);
  if (meta.protocol !== null)
    throw new Error(&apos;only support for no protocol url&apos;);
  if (typeof callback !== &apos;function&apos;)
    callback = defaultCallback;
  
  var extname = path.extname(meta.pathname);
  if (extname === &apos;.wav&apos;) {
    this._cmd = `paplay ${meta.pathname}`;
  } else if ([&apos;.ogg&apos;, &apos;.mp3&apos;].indexOf(extname) &gt;= 0) {
    this._cmd = `ffmpeg -i ${meta.pathname} -acodec pcm_s16le -ar 16000 -f wav - | paplay`;
  } else {
    throw new Error(&apos;only support for wav/ogg/mp3 formats&apos;);
  }
  this._subprocess = child_process.exec(this._cmd, {
    env: { &apos;HOME&apos;: PA_HOME_DIR },
  }, function ondone(err, stdout, stderr) {
    if (err)
      return callback(new Error(stderr));
    callback(null, stdout);
  });
  return this;
};

/**
 * @method stop
 * @return {SoundPlayer}
 */
SoundPlayer.prototype.stop = function stop() {
  if (this._subprocess) {
    this._subprocess.kill(0);
    this._subprocess = null;
  }
  return this;
};

/**
 * @method play
 * @param {String} media - the media url to play
 * @return {SoundPlayer}
 */
function play(media, callback) {
  var splayer = new SoundPlayer(media);
  return splayer.play(callback);
}

exports.set = set;
exports.play = play;

</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
